<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memoria del Proyecto - Sistema de Control de Fichajes de Empleados</title>
    <style>
        /* ============================================
           CONFIGURACIÓN DE PÁGINA PARA PDF
           ============================================ */
        @page {
            size: A4;
            margin: 20mm 15mm 20mm 15mm;
        }
        
        @media print {
            html, body {
                width: 210mm;
                height: 297mm;
            }
            
            body {
                margin: 0;
                padding: 0;
            }
            
            /* Forzar salto de página */
            .page-break {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            /* Evitar salto después de títulos */
            h1, h2, h3, h4 {
                page-break-after: avoid !important;
                break-after: avoid !important;
            }
            
            /* Mantener secciones juntas */
            .keep-together {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
            
            /* Evitar huérfanos y viudas */
            p {
                orphans: 3;
                widows: 3;
            }
            
            /* Tablas no se cortan */
            table {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
            
            /* Bloques de código no se cortan */
            pre {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
            
            /* Listas cortas no se cortan */
            ul, ol {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
            
            /* Cajas informativas no se cortan */
            .info-box, .warning-box, .success-box, .legal-article {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
        }
        
        /* ============================================
           ESTILOS GENERALES
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 1.6;
            color: #1a1a1a;
            max-width: 210mm;
            margin: 0 auto;
            padding: 15mm;
            background: white;
            font-size: 11pt;
        }
        
        /* ============================================
           PORTADA
           ============================================ */
        .cover-page {
            height: 260mm;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            page-break-after: always;
            break-after: page;
        }
        
        .cover-page h1 {
            font-size: 26pt;
            color: #1e3a5f;
            margin-bottom: 15px;
            line-height: 1.2;
            border: none;
            padding: 0;
        }
        
        .cover-page .subtitle {
            font-size: 14pt;
            color: #4a5568;
            margin-bottom: 10px;
        }
        
        .cover-page .subtitle-main {
            font-size: 12pt;
            color: #1e3a5f;
            font-weight: bold;
            margin-top: 30px;
        }
        
        .cover-page .info {
            margin-top: 50px;
            font-size: 12pt;
            color: #2d3748;
        }
        
        .cover-page .date {
            margin-top: 40px;
            font-size: 11pt;
            color: #718096;
        }
        
        /* ============================================
           ÍNDICE
           ============================================ */
        .toc {
            page-break-after: always;
            break-after: page;
        }
        
        .toc h2 {
            color: #1e3a5f;
            border-bottom: 2px solid #1e3a5f;
            padding-bottom: 8px;
            margin-bottom: 20px;
            font-size: 18pt;
        }
        
        .toc ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .toc li {
            padding: 3px 0;
            border-bottom: 1px dotted #ccc;
            font-size: 10pt;
        }
        
        .toc a {
            color: #1a1a1a;
            text-decoration: none;
        }
        
        .toc .level-1 { 
            font-weight: bold; 
            margin-top: 10px;
            font-size: 11pt;
        }
        .toc .level-2 { 
            padding-left: 15px;
            font-size: 10pt;
        }
        
        /* ============================================
           TÍTULOS
           ============================================ */
        h1 {
            font-size: 20pt;
            color: #1e3a5f;
            margin: 0 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #1e3a5f;
            page-break-after: avoid;
        }
        
        h2 {
            font-size: 14pt;
            color: #2c5282;
            margin: 20px 0 12px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #4299e1;
            page-break-after: avoid;
        }
        
        h3 {
            font-size: 12pt;
            color: #2b6cb0;
            margin: 15px 0 8px 0;
            page-break-after: avoid;
        }
        
        h4 {
            font-size: 11pt;
            color: #3182ce;
            margin: 12px 0 6px 0;
            page-break-after: avoid;
        }
        
        /* ============================================
           CONTENIDO
           ============================================ */
        p {
            margin-bottom: 10px;
            text-align: justify;
        }
        
        ul, ol {
            margin: 8px 0 12px 20px;
        }
        
        li {
            margin-bottom: 4px;
        }
        
        li ul, li ol {
            margin: 4px 0 4px 15px;
        }
        
        strong {
            color: #1a1a1a;
        }
        
        /* ============================================
           TABLAS
           ============================================ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 9pt;
            page-break-inside: avoid;
        }
        
        th, td {
            border: 1px solid #a0aec0;
            padding: 6px 8px;
            text-align: left;
        }
        
        th {
            background-color: #1e3a5f;
            color: white;
            font-weight: bold;
            font-size: 9pt;
        }
        
        tr:nth-child(even) {
            background-color: #f7fafc;
        }
        
        /* ============================================
           CÓDIGO
           ============================================ */
        code {
            background-color: #edf2f7;
            padding: 1px 4px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 9pt;
        }
        
        pre {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 12px 0;
            font-size: 8pt;
            line-height: 1.4;
            page-break-inside: avoid;
        }
        
        /* ============================================
           CAJAS INFORMATIVAS
           ============================================ */
        .info-box {
            background-color: #ebf8ff;
            padding: 12px;
            border-left: 4px solid #3182ce;
            margin: 12px 0;
            page-break-inside: avoid;
        }
        
        .warning-box {
            background-color: #fff5f5;
            padding: 12px;
            border-left: 4px solid #e53e3e;
            margin: 12px 0;
            page-break-inside: avoid;
        }
        
        .success-box {
            background-color: #f0fff4;
            padding: 12px;
            border-left: 4px solid #38a169;
            margin: 12px 0;
            page-break-inside: avoid;
        }
        
        .legal-article {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            padding: 12px;
            margin: 12px 0;
            border-radius: 4px;
            page-break-inside: avoid;
        }
        
        .legal-article h4 {
            color: #1e3a5f;
            margin-bottom: 8px;
            margin-top: 0;
        }
        
        /* ============================================
           SECCIONES (para mantener juntas)
           ============================================ */
        .section {
            page-break-inside: avoid;
        }
        
        .section-small {
            page-break-inside: avoid;
            margin-bottom: 15px;
        }
        
        /* ============================================
           DIAGRAMAS
           ============================================ */
        .diagram {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            padding: 15px;
            margin: 12px 0;
            border-radius: 4px;
            page-break-inside: avoid;
            overflow-x: auto;
        }
        
        .diagram pre {
            background: transparent;
            color: #2d3748;
            padding: 0;
            margin: 0;
            font-size: 7pt;
            line-height: 1.3;
        }
        
        /* ============================================
           CAPÍTULO (nuevo capítulo = nueva página)
           ============================================ */
        .chapter {
            page-break-before: always;
            break-before: page;
        }
        
        /* ============================================
           PIE DE PÁGINA
           ============================================ */
        .footer-final {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid #e2e8f0;
        }
        
        .footer-final h2 {
            border: none;
            color: #1e3a5f;
        }
    </style>
</head>
<body>

<!-- ==================== PORTADA ==================== -->
<div class="cover-page">
    <h1>SISTEMA DE CONTROL DE<br>FICHAJES DE EMPLEADOS</h1>
    <p class="subtitle">Aplicación Web y Móvil para la Gestión del Tiempo de Trabajo</p>
    <p class="subtitle-main">Adaptado a la Nueva Normativa Española<br>de Registro Horario Digital</p>
    <div class="info">
        <p><strong>TRABAJO DE FIN DE GRADO</strong></p>
        <p style="margin-top: 8px;">Grado en Ingeniería Informática</p>
        <p style="margin-top: 20px; font-size: 10pt; color: #4a5568;">
            React · TypeScript · Node.js · PostgreSQL · React Native
        </p>
    </div>
    <div class="date">
        <p>Curso Académico 2024-2025</p>
        <p>Diciembre 2025</p>
    </div>
</div>

<!-- ==================== ÍNDICE ==================== -->
<div class="toc">
    <h2>TABLA DE CONTENIDO</h2>
    <ul>
        <li class="level-1">1. MOTIVACIÓN Y JUSTIFICACIÓN DEL PROYECTO</li>
        <li class="level-2">1.1. Contexto Legal en España</li>
        <li class="level-2">1.2. Nueva Normativa de Registro Horario Digital</li>
        <li class="level-2">1.3. Requisitos Técnicos Exigidos por la Ley</li>
        <li class="level-2">1.4. Necesidad de una Solución Tecnológica</li>
        
        <li class="level-1">2. INTRODUCCIÓN AL PROYECTO</li>
        <li class="level-2">2.1. Descripción del Proyecto</li>
        <li class="level-2">2.2. Información General</li>
        <li class="level-2">2.3. Objetivos del Proyecto</li>
        <li class="level-2">2.4. Alcance y Limitaciones</li>
        
        <li class="level-1">3. CONTEXTUALIZACIÓN TÉCNICA</li>
        <li class="level-2">3.1. Objetivos Concretos</li>
        <li class="level-2">3.2. Tecnologías Utilizadas</li>
        <li class="level-2">3.3. Tecnologías Alternativas Evaluadas</li>
        <li class="level-2">3.4. Justificación de Decisiones Tecnológicas</li>
        
        <li class="level-1">4. PLANIFICACIÓN DEL PROYECTO</li>
        <li class="level-2">4.1. Temporalización</li>
        <li class="level-2">4.2. Metodología de Desarrollo</li>
        <li class="level-2">4.3. Gestión de Riesgos</li>
        
        <li class="level-1">5. DESARROLLO DEL PROYECTO</li>
        <li class="level-2">5.0. Fase Previa: Configuración del Entorno</li>
        <li class="level-2">5.1. Fase de Concepción y Análisis</li>
        <li class="level-2">5.2. Fase de Diseño</li>
        <li class="level-2">5.3. Fase de Planificación Técnica</li>
        <li class="level-2">5.4. Fase de Producción</li>
        <li class="level-2">5.5. Fase de Pruebas</li>
        <li class="level-2">5.6. Fase de Despliegue</li>
        
        <li class="level-1">6. ARQUITECTURA DE LA APLICACIÓN</li>
        <li class="level-2">6.1. Arquitectura General del Sistema</li>
        <li class="level-2">6.2. Arquitectura del Backend</li>
        <li class="level-2">6.3. Arquitectura del Frontend</li>
        <li class="level-2">6.4. Arquitectura de la Aplicación Móvil</li>
        
        <li class="level-1">7. IMPLEMENTACIÓN DETALLADA</li>
        <li class="level-2">7.1. Sistema de Autenticación</li>
        <li class="level-2">7.2. Sistema de Fichaje</li>
        <li class="level-2">7.3. Gestión de Horarios</li>
        <li class="level-2">7.4. Generación de Informes</li>
        <li class="level-2">7.5. Geolocalización</li>
        
        <li class="level-1">8. ESTRUCTURA VISUAL</li>
        <li class="level-2">8.1. Interfaz Web</li>
        <li class="level-2">8.2. Interfaz Móvil</li>
        
        <li class="level-1">9. GESTIÓN DE DATOS</li>
        <li class="level-2">9.1. Modelo de Datos Completo</li>
        <li class="level-2">9.2. Gestión de Zonas Horarias</li>
        <li class="level-2">9.3. Integridad y Consistencia</li>
        
        <li class="level-1">10. SEGURIDAD</li>
        <li class="level-2">10.1. Autenticación</li>
        <li class="level-2">10.2. Autorización</li>
        <li class="level-2">10.3. Protección de Datos (RGPD)</li>
        
        <li class="level-1">11. TESTS Y VALIDACIÓN</li>
        
        <li class="level-1">12. CUMPLIMIENTO NORMATIVO</li>
        
        <li class="level-1">13. ANÁLISIS Y VALORACIÓN</li>
        <li class="level-2">13.1. Conclusiones</li>
        <li class="level-2">13.2. Mejoras Propuestas</li>
        
        <li class="level-1">14. BIBLIOGRAFÍA Y REFERENCIAS</li>
        
        <li class="level-1">15. ANEXOS</li>
    </ul>
</div>

<!-- ==================== CAPÍTULO 1 ==================== -->
<div class="chapter">
    <h1>1. MOTIVACIÓN Y JUSTIFICACIÓN DEL PROYECTO</h1>
    
    <p>El presente Trabajo de Fin de Grado surge como respuesta a una necesidad real y urgente del tejido empresarial español: la obligación legal de implementar sistemas de registro horario digital que cumplan con la nueva normativa laboral. Este capítulo analiza el contexto legal que motiva el desarrollo del proyecto y justifica la necesidad de crear una solución tecnológica específica.</p>

    <h2>1.1. Contexto Legal en España</h2>
    
    <p>Desde el año 2019, con la entrada en vigor del <strong>Real Decreto-ley 8/2019, de 8 de marzo</strong>, de medidas urgentes de protección social y de lucha contra la precariedad laboral en la jornada de trabajo, todas las empresas en España están obligadas a llevar un registro diario de la jornada laboral de sus trabajadores.</p>

    <p>Esta normativa supuso un cambio significativo en la gestión del tiempo de trabajo, estableciendo la obligatoriedad de registrar la hora de inicio y fin de la jornada de cada empleado.</p>

    <div class="legal-article">
        <h4>Real Decreto-ley 8/2019, de 8 de marzo</h4>
        <p><em>"La empresa garantizará el registro diario de jornada, que deberá incluir el horario concreto de inicio y finalización de la jornada de trabajo de cada persona trabajadora, sin perjuicio de la flexibilidad horaria que se establece en este artículo."</em></p>
        <p style="font-size: 9pt; color: #718096; margin-top: 8px;">Artículo 34.9 del Estatuto de los Trabajadores (modificado por el RDL 8/2019)</p>
    </div>

    <div class="section-small">
        <p>Los objetivos principales de esta regulación fueron:</p>
        <ul>
            <li><strong>Combatir la precariedad laboral:</strong> Evitar abusos en las jornadas de trabajo no remuneradas</li>
            <li><strong>Controlar las horas extraordinarias:</strong> Garantizar su correcta contabilización y compensación</li>
            <li><strong>Proteger los derechos de los trabajadores:</strong> Asegurar el cumplimiento de los límites de jornada</li>
            <li><strong>Facilitar la labor inspectora:</strong> Proporcionar evidencias objetivas para las actuaciones de la Inspección de Trabajo</li>
        </ul>
    </div>

    <h3>1.1.1. Problemática Detectada (2019-2024)</h3>
    
    <div class="section-small">
        <p>Durante los cinco años de vigencia de la normativa inicial, la Inspección de Trabajo y Seguridad Social ha detectado numerosas irregularidades:</p>
        <ul>
            <li><strong>Registros manipulados:</strong> Hojas de papel rellenadas a posteriori con datos falsos</li>
            <li><strong>Ficheros Excel editables:</strong> Modificaciones de horarios para ocultar horas extras</li>
            <li><strong>Falta de trazabilidad:</strong> Imposibilidad de verificar cuándo se realizaron los registros</li>
            <li><strong>Fichaje por terceros:</strong> Empleados que fichan por compañeros ausentes</li>
            <li><strong>Sistemas biométricos invasivos:</strong> Uso desproporcionado de huella dactilar y reconocimiento facial</li>
        </ul>
    </div>

    <h2>1.2. Nueva Normativa de Registro Horario Digital</h2>
    
    <p>Ante las deficiencias detectadas, el Gobierno de España ha impulsado una nueva regulación que introduce cambios sustanciales en los requisitos del registro horario. Esta nueva normativa, actualmente en tramitación parlamentaria (diciembre 2025), establece la <strong>obligatoriedad del formato digital</strong> para el registro de jornada.</p>

    <h3>1.2.1. Principales Novedades de la Nueva Ley</h3>
    
    <table>
        <tr>
            <th>Aspecto</th>
            <th>Normativa 2019</th>
            <th>Nueva Normativa 2024-2025</th>
        </tr>
        <tr>
            <td>Formato del registro</td>
            <td>Libre (papel, Excel, digital)</td>
            <td><strong>Digital obligatorio</strong></td>
        </tr>
        <tr>
            <td>Métodos permitidos</td>
            <td>Sin restricciones específicas</td>
            <td>Solo sistemas electrónicos trazables</td>
        </tr>
        <tr>
            <td>Acceso de la Inspección</td>
            <td>Presencial, bajo solicitud</td>
            <td><strong>Telemático en tiempo real</strong></td>
        </tr>
        <tr>
            <td>Modificaciones</td>
            <td>Sin control específico</td>
            <td>Trazabilidad completa de cambios</td>
        </tr>
        <tr>
            <td>Biometría</td>
            <td>Permitida sin restricciones</td>
            <td><strong>Restringida</strong> (casos excepcionales)</td>
        </tr>
        <tr>
            <td>Conservación</td>
            <td>4 años</td>
            <td>4 años (sin cambios)</td>
        </tr>
        <tr>
            <td>Sanciones máximas</td>
            <td>Hasta 6.250 € (grave)</td>
            <td>Hasta <strong>225.018 €</strong> (muy grave)</td>
        </tr>
    </table>

    <h3>1.2.2. Cronología de la Nueva Normativa</h3>
    
    <div class="section-small">
        <ul>
            <li><strong>Marzo 2019:</strong> Entrada en vigor del Real Decreto-ley 8/2019. Obligación de registro horario.</li>
            <li><strong>2020-2023:</strong> Periodo de adaptación. La Inspección detecta numerosas irregularidades.</li>
            <li><strong>2024:</strong> El Ministerio de Trabajo anuncia la reforma para exigir el registro digital obligatorio.</li>
            <li><strong>Diciembre 2025:</strong> La normativa se encuentra en trámite parlamentario.</li>
            <li><strong>2026 (previsto):</strong> Entrada en vigor tras un periodo de adaptación de 5-6 meses.</li>
        </ul>
    </div>

    <h3>1.2.3. Ámbito de Aplicación</h3>
    
    <div class="section-small">
        <p>La nueva normativa de registro horario digital se aplica a:</p>
        <ul>
            <li><strong>Todas las empresas</strong>, sin importar tamaño o sector (grandes empresas, PYMES, microempresas, autónomos con empleados)</li>
            <li><strong>Todos los sectores de actividad:</strong> industria, comercio, hostelería, servicios, construcción, transporte, tecnología</li>
            <li><strong>Todos los tipos de trabajadores:</strong> contratos indefinidos, temporales, a tiempo parcial, en prácticas, teletrabajadores</li>
        </ul>
    </div>

    <div class="info-box">
        <strong>Exclusiones:</strong> Quedan excluidos de la obligación los autónomos sin empleados a su cargo y los becarios (aunque estos últimos deben llevar un control de horas de beca, pero sin las formalidades del registro laboral).
    </div>
</div>

<!-- ==================== CAPÍTULO 1 - CONTINUACIÓN ==================== -->
<div class="chapter">
    <h2>1.3. Requisitos Técnicos Exigidos por la Ley</h2>
    
    <p>La nueva normativa establece requisitos técnicos específicos que deben cumplir los sistemas de registro horario digital. Estos requisitos son fundamentales para garantizar la validez legal del registro y evitar sanciones.</p>

    <h3>1.3.1. Requisitos Obligatorios del Sistema</h3>
    
    <table>
        <tr>
            <th>Requisito</th>
            <th>Descripción</th>
            <th>Cumplimiento en Este Proyecto</th>
        </tr>
        <tr>
            <td>Formato digital</td>
            <td>El sistema debe ser electrónico</td>
            <td>✓ Aplicación web y móvil</td>
        </tr>
        <tr>
            <td>Trazabilidad</td>
            <td>Identificación inequívoca del empleado, fecha y hora</td>
            <td>✓ UUID de usuario, timestamps en UTC</td>
        </tr>
        <tr>
            <td>Inmutabilidad</td>
            <td>Evitar modificaciones no autorizadas</td>
            <td>✓ Entradas clock_entries inmutables</td>
        </tr>
        <tr>
            <td>Accesibilidad</td>
            <td>Trabajadores e Inspección pueden consultar</td>
            <td>✓ Historial visible para empleados</td>
        </tr>
        <tr>
            <td>Conservación</td>
            <td>Registros guardados durante 4 años mínimo</td>
            <td>✓ Base de datos PostgreSQL persistente</td>
        </tr>
        <tr>
            <td>Registro de pausas</td>
            <td>Pausas que afecten al cómputo horario</td>
            <td>✓ break_start y break_end implementados</td>
        </tr>
        <tr>
            <td>Fichaje personal</td>
            <td>Por el propio trabajador</td>
            <td>✓ Login individual requerido</td>
        </tr>
        <tr>
            <td>Interoperabilidad</td>
            <td>Compatible con sistemas de la Administración</td>
            <td>✓ Exportación Excel estándar</td>
        </tr>
        <tr>
            <td>Servidores en UE</td>
            <td>Cumplimiento RGPD</td>
            <td>✓ PostgreSQL en servidores europeos</td>
        </tr>
    </table>

    <h3>1.3.2. Métodos NO Permitidos</h3>
    
    <div class="warning-box">
        <strong>Métodos prohibidos por la nueva normativa:</strong>
        <ul>
            <li><strong>Hojas de papel:</strong> Partes de firma, libros de registro físicos</li>
            <li><strong>Excel u hojas de cálculo:</strong> Por ser fácilmente manipulables</li>
            <li><strong>Sistemas biométricos:</strong> Huella dactilar, reconocimiento facial (salvo casos excepcionales)</li>
            <li><strong>Geolocalización permanente:</strong> El seguimiento GPS fuera de la jornada laboral está prohibido</li>
            <li><strong>Fichaje con móvil personal obligatorio:</strong> La empresa debe proporcionar los medios</li>
        </ul>
    </div>

    <h3>1.3.3. Métodos Permitidos</h3>
    
    <div class="success-box">
        <strong>Métodos válidos según la nueva normativa:</strong>
        <ul>
            <li><strong>Software de control horario:</strong> Aplicaciones SaaS, cloud, on-premise</li>
            <li><strong>Aplicaciones móviles:</strong> Apps iOS/Android proporcionadas por la empresa</li>
            <li><strong>Terminales físicos:</strong> Tablets, quioscos digitales, terminales de fichaje</li>
            <li><strong>Tarjetas electrónicas:</strong> Con código único e identificación del empleado</li>
            <li><strong>Códigos QR:</strong> Escaneados con dispositivos de la empresa</li>
            <li><strong>Acceso web:</strong> Plataformas online con login individual</li>
        </ul>
    </div>

    <h3>1.3.4. Régimen Sancionador</h3>
    
    <table>
        <tr>
            <th>Tipo de Infracción</th>
            <th>Ejemplos</th>
            <th>Sanción</th>
        </tr>
        <tr>
            <td>Leve</td>
            <td>Defectos formales menores en el registro</td>
            <td>60 € - 625 €</td>
        </tr>
        <tr>
            <td>Grave</td>
            <td>No disponer de sistema de registro, no conservar registros 4 años</td>
            <td>625 € - 6.250 €</td>
        </tr>
        <tr>
            <td>Muy Grave</td>
            <td>Falsificación de registros, exceso reiterado de horas extras</td>
            <td>6.251 € - 225.018 €</td>
        </tr>
    </table>

    <p>Según datos de la Inspección de Trabajo (2024), se impusieron <strong>20,2 millones de euros en sanciones</strong> por incumplimiento del registro horario, afectando a más de 21.000 trabajadores.</p>

    <h2>1.4. Necesidad de una Solución Tecnológica</h2>
    
    <p>Ante el panorama normativo descrito, la necesidad de contar con una solución tecnológica adecuada es evidente. Este proyecto nace precisamente para dar respuesta a esta demanda del mercado.</p>

    <h3>1.4.1. Beneficios para las Empresas</h3>
    
    <div class="section-small">
        <ol>
            <li><strong>Cumplimiento legal garantizado:</strong> El sistema está diseñado siguiendo todos los requisitos técnicos.</li>
            <li><strong>Reducción de costes:</strong> Evita sanciones de hasta 225.000 € y automatiza procesos manuales.</li>
            <li><strong>Transparencia:</strong> Los empleados tienen acceso a su historial, reduciendo conflictos laborales.</li>
            <li><strong>Optimización de recursos:</strong> Los informes automáticos facilitan la gestión de RRHH.</li>
            <li><strong>Preparación para inspecciones:</strong> Los datos están siempre disponibles y exportables.</li>
        </ol>
    </div>

    <h3>1.4.2. Beneficios para los Trabajadores</h3>
    
    <div class="section-small">
        <ol>
            <li><strong>Control de su tiempo:</strong> Visibilidad total sobre sus horas trabajadas.</li>
            <li><strong>Garantía de derechos:</strong> Las horas extras quedan registradas fehacientemente.</li>
            <li><strong>Facilidad de uso:</strong> Fichaje rápido desde móvil o web.</li>
            <li><strong>Conciliación:</strong> Mejor control favorece el respeto a los horarios pactados.</li>
        </ol>
    </div>

    <h3>1.4.3. Justificación Académica</h3>
    
    <div class="section-small">
        <p>Desde el punto de vista académico, este proyecto permite:</p>
        <ul>
            <li>Aplicar conocimientos de desarrollo full-stack (frontend, backend, base de datos)</li>
            <li>Trabajar con tecnologías modernas demandadas en el mercado laboral</li>
            <li>Desarrollar una aplicación móvil nativa con React Native</li>
            <li>Implementar sistemas de autenticación y autorización</li>
            <li>Gestionar datos complejos con relaciones entre entidades</li>
            <li>Resolver problemas reales como la gestión de zonas horarias</li>
        </ul>
    </div>
</div>

<!-- ==================== CAPÍTULO 2 ==================== -->
<div class="chapter">
    <h1>2. INTRODUCCIÓN AL PROYECTO</h1>
    
    <h2>2.1. Descripción del Proyecto</h2>
    
    <p>El Sistema de Control de Fichajes de Empleados es una <strong>solución integral de gestión del tiempo de trabajo</strong> desarrollada para satisfacer las necesidades de empresas de cualquier tamaño que buscan cumplir con la normativa española de registro horario de manera eficiente y moderna.</p>

    <p>El proyecto se compone de dos aplicaciones principales que trabajan de forma coordinada:</p>

    <h3>2.1.1. Aplicación Web (Panel de Administración)</h3>
    
    <div class="section-small">
        <p>La aplicación web está diseñada para los administradores y responsables de recursos humanos:</p>
        <ul>
            <li><strong>Dashboard:</strong> Visión general del estado de la plantilla en tiempo real</li>
            <li><strong>Gestión de empleados:</strong> Alta, baja y modificación de empleados</li>
            <li><strong>Control de fichajes:</strong> Visualización de fichajes del día con ubicaciones en mapa</li>
            <li><strong>Planificación de horarios:</strong> Calendario anual para asignar turnos</li>
            <li><strong>Gestión de incidencias:</strong> Registro de ausencias, permisos, vacaciones</li>
            <li><strong>Generación de informes:</strong> Exportación de datos a Excel</li>
            <li><strong>Configuración:</strong> Gestión de departamentos, roles y tipos de incidencia</li>
        </ul>
    </div>

    <h3>2.1.2. Aplicación Móvil (Para Empleados)</h3>
    
    <div class="section-small">
        <p>La aplicación móvil está orientada a los empleados:</p>
        <ul>
            <li><strong>Fichaje rápido:</strong> Registro de entrada, salida e inicio/fin de pausas</li>
            <li><strong>Geolocalización:</strong> Captura opcional de ubicación GPS al fichar</li>
            <li><strong>Consulta de horarios:</strong> Visualización de los turnos asignados</li>
            <li><strong>Historial:</strong> Acceso al historial de fichajes propios</li>
            <li><strong>Perfil:</strong> Gestión de datos personales y cierre de sesión</li>
        </ul>
    </div>

    <h2>2.2. Información General</h2>
    
    <table>
        <tr>
            <th>Característica</th>
            <th>Descripción</th>
        </tr>
        <tr>
            <td>Tipo de proyecto</td>
            <td>Aplicación Full-Stack (Web + Móvil)</td>
        </tr>
        <tr>
            <td>Arquitectura</td>
            <td>Monorepo con código compartido</td>
        </tr>
        <tr>
            <td>Entorno de desarrollo</td>
            <td>Visual Studio Code</td>
        </tr>
        <tr>
            <td>Lenguaje principal</td>
            <td>TypeScript (100% del código)</td>
        </tr>
        <tr>
            <td>Base de datos</td>
            <td>PostgreSQL</td>
        </tr>
        <tr>
            <td>Frontend Web</td>
            <td>React 18 + Vite + Tailwind CSS</td>
        </tr>
        <tr>
            <td>Frontend Móvil</td>
            <td>React Native + Expo SDK 52</td>
        </tr>
        <tr>
            <td>Backend</td>
            <td>Node.js + Express</td>
        </tr>
        <tr>
            <td>ORM</td>
            <td>Drizzle ORM</td>
        </tr>
        <tr>
            <td>Validación</td>
            <td>Zod (esquemas compartidos)</td>
        </tr>
        <tr>
            <td>Estado del servidor</td>
            <td>TanStack Query v5</td>
        </tr>
        <tr>
            <td>Autenticación Web</td>
            <td>Sesiones (express-session)</td>
        </tr>
        <tr>
            <td>Autenticación Móvil</td>
            <td>JWT (jsonwebtoken)</td>
        </tr>
        <tr>
            <td>Despliegue</td>
            <td>Railway (backend) + Vercel (frontend)</td>
        </tr>
    </table>

    <h2>2.3. Objetivos del Proyecto</h2>
    
    <h3>2.3.1. Objetivo Principal</h3>
    
    <p>Desarrollar una solución completa y profesional para la gestión del tiempo de trabajo que cumpla con todos los requisitos de la nueva normativa española de registro horario digital, proporcionando a las empresas una herramienta fiable, segura y fácil de usar.</p>

    <h3>2.3.2. Objetivos Específicos</h3>
    
    <div class="section-small">
        <ol>
            <li><strong>Digitalizar el proceso de fichaje:</strong> Eliminar sistemas manuales, proporcionar trazabilidad</li>
            <li><strong>Proporcionar visibilidad en tiempo real:</strong> Dashboard con estado actual de la plantilla</li>
            <li><strong>Facilitar la movilidad laboral:</strong> Aplicación móvil nativa para iOS y Android</li>
            <li><strong>Automatizar la generación de informes:</strong> Exportación a Excel con formato profesional</li>
            <li><strong>Garantizar la seguridad de los datos:</strong> Autenticación robusta, cumplimiento RGPD</li>
        </ol>
    </div>

    <h2>2.4. Alcance y Limitaciones</h2>
    
    <h3>2.4.1. Funcionalidades Incluidas</h3>
    
    <div class="section-small">
        <ul>
            <li>Autenticación de usuarios (administradores y empleados)</li>
            <li>Gestión completa de empleados (CRUD)</li>
            <li>Gestión de departamentos y roles empresariales</li>
            <li>Registro de fichajes (entrada, salida, pausas)</li>
            <li>Geolocalización de fichajes (opcional)</li>
            <li>Planificación de horarios con calendario anual</li>
            <li>Gestión de incidencias laborales</li>
            <li>Dashboard con estadísticas en tiempo real</li>
            <li>Generación de informes en Excel</li>
            <li>Visualización de ubicaciones en mapa</li>
            <li>Modo claro/oscuro e interfaz responsive</li>
            <li>Aplicación móvil nativa</li>
        </ul>
    </div>

    <h3>2.4.2. Limitaciones Actuales</h3>
    
    <div class="section-small">
        <ul>
            <li>No incluye integración con sistemas de nóminas</li>
            <li>No incluye notificaciones push (pendiente de implementación)</li>
            <li>No incluye reconocimiento biométrico (no recomendado por AEPD)</li>
            <li>No incluye fichaje offline (requiere conexión a internet)</li>
            <li>No incluye multi-idioma (actualmente solo español)</li>
        </ul>
    </div>
</div>

<!-- ==================== CAPÍTULO 3 ==================== -->
<div class="chapter">
    <h1>3. CONTEXTUALIZACIÓN TÉCNICA</h1>
    
    <h2>3.1. Objetivos Concretos</h2>
    
    <h3>3.1.1. Objetivos Funcionales</h3>
    
    <table>
        <tr>
            <th>ID</th>
            <th>Objetivo</th>
            <th>Prioridad</th>
            <th>Estado</th>
        </tr>
        <tr><td>OF-01</td><td>Sistema de autenticación seguro con roles</td><td>Alta</td><td>✓ Completado</td></tr>
        <tr><td>OF-02</td><td>Funcionalidad de fichaje con registro temporal</td><td>Alta</td><td>✓ Completado</td></tr>
        <tr><td>OF-03</td><td>Módulo de gestión de empleados (CRUD)</td><td>Alta</td><td>✓ Completado</td></tr>
        <tr><td>OF-04</td><td>Gestión de departamentos y roles</td><td>Media</td><td>✓ Completado</td></tr>
        <tr><td>OF-05</td><td>Sistema de planificación de horarios</td><td>Alta</td><td>✓ Completado</td></tr>
        <tr><td>OF-06</td><td>Calendario anual para asignación de turnos</td><td>Media</td><td>✓ Completado</td></tr>
        <tr><td>OF-07</td><td>Módulo de incidencias</td><td>Media</td><td>✓ Completado</td></tr>
        <tr><td>OF-08</td><td>Geolocalización en fichajes móviles</td><td>Media</td><td>✓ Completado</td></tr>
        <tr><td>OF-09</td><td>Generación de informes Excel</td><td>Alta</td><td>✓ Completado</td></tr>
        <tr><td>OF-10</td><td>Dashboard con estadísticas en tiempo real</td><td>Media</td><td>✓ Completado</td></tr>
        <tr><td>OF-11</td><td>Visualización de ubicaciones en mapa</td><td>Baja</td><td>✓ Completado</td></tr>
        <tr><td>OF-12</td><td>Aplicación móvil completa</td><td>Alta</td><td>✓ Completado</td></tr>
    </table>

    <h3>3.1.2. Objetivos Técnicos</h3>
    
    <table>
        <tr>
            <th>ID</th>
            <th>Objetivo</th>
            <th>Estado</th>
        </tr>
        <tr><td>OT-01</td><td>Utilizar TypeScript en todo el proyecto para tipado estático</td><td>✓ Completado</td></tr>
        <tr><td>OT-02</td><td>Implementar arquitectura modular (routes, services, storages)</td><td>✓ Completado</td></tr>
        <tr><td>OT-03</td><td>Gestionar fechas en UTC, mostrar en zona horaria española</td><td>✓ Completado</td></tr>
        <tr><td>OT-04</td><td>Diseñar API RESTful siguiendo mejores prácticas</td><td>✓ Completado</td></tr>
        <tr><td>OT-05</td><td>Implementar validación en frontend y backend con Zod</td><td>✓ Completado</td></tr>
        <tr><td>OT-06</td><td>Crear interfaces responsive para cualquier dispositivo</td><td>✓ Completado</td></tr>
        <tr><td>OT-07</td><td>Optimizar consultas de base de datos</td><td>✓ Completado</td></tr>
        <tr><td>OT-08</td><td>Implementar modo claro/oscuro</td><td>✓ Completado</td></tr>
    </table>

    <h2>3.2. Tecnologías Utilizadas</h2>
    
    <h3>3.2.1. Frontend Web</h3>
    
    <div class="section-small">
        <p><strong>React 18:</strong> Biblioteca de JavaScript más popular para la construcción de interfaces de usuario. Incluye Concurrent Rendering y Automatic Batching.</p>
        <p><strong>TypeScript:</strong> Añade tipado estático a JavaScript, proporcionando detección de errores en tiempo de desarrollo.</p>
        <p><strong>Vite:</strong> Build tool de nueva generación con arranque instantáneo y Hot Module Replacement ultrarrápido.</p>
        <p><strong>Tailwind CSS:</strong> Framework de CSS utility-first que permite desarrollo rápido y diseño consistente.</p>
        <p><strong>Shadcn/UI + Radix UI:</strong> Colección de componentes accesibles y personalizables con accesibilidad WCAG incorporada.</p>
        <p><strong>TanStack Query v5:</strong> Biblioteca para gestión del estado del servidor con caché automático.</p>
    </div>

    <h3>3.2.2. Frontend Móvil</h3>
    
    <div class="section-small">
        <p><strong>Expo SDK 52:</strong> Framework que simplifica el desarrollo con React Native, sin necesidad de Xcode o Android Studio.</p>
        <p><strong>Expo Router:</strong> Sistema de navegación basado en el sistema de archivos con navegación por tabs.</p>
    </div>

    <h3>3.2.3. Backend</h3>
    
    <div class="section-small">
        <p><strong>Node.js:</strong> Entorno de ejecución de JavaScript del lado del servidor con modelo de I/O no bloqueante.</p>
        <p><strong>Express:</strong> Framework web minimalista y flexible con middleware system.</p>
        <p><strong>Drizzle ORM:</strong> ORM moderno con enfoque "type-safe" y sintaxis SQL-like intuitiva.</p>
    </div>

    <h3>3.2.4. Base de Datos</h3>
    
    <div class="section-small">
        <p><strong>PostgreSQL:</strong> Sistema de gestión de base de datos relacional ACID compliant con soporte para tipos de datos avanzados y funciones de fecha/hora con zonas horarias.</p>
    </div>

    <h2>3.3. Tecnologías Alternativas Evaluadas</h2>
    
    <table>
        <tr>
            <th>Categoría</th>
            <th>Alternativas</th>
            <th>Elección</th>
            <th>Justificación</th>
        </tr>
        <tr><td>Frontend</td><td>Vue.js, Angular, Svelte</td><td>React</td><td>Mayor ecosistema, integración con React Native</td></tr>
        <tr><td>Móvil</td><td>Flutter, Ionic, NativeScript</td><td>React Native + Expo</td><td>Código compartido con web</td></tr>
        <tr><td>Backend</td><td>NestJS, Fastify, Hono</td><td>Express</td><td>Simplicidad, madurez, documentación</td></tr>
        <tr><td>ORM</td><td>Prisma, TypeORM, Sequelize</td><td>Drizzle</td><td>Mejor rendimiento, tipado más estricto</td></tr>
        <tr><td>Base de Datos</td><td>MySQL, MongoDB, SQLite</td><td>PostgreSQL</td><td>Robustez, características avanzadas</td></tr>
    </table>

    <h2>3.4. Justificación de Decisiones Tecnológicas</h2>
    
    <h3>3.4.1. ¿Por qué TypeScript?</h3>
    
    <div class="section-small">
        <ul>
            <li><strong>Seguridad de tipos:</strong> Detecta errores en tiempo de compilación</li>
            <li><strong>Productividad:</strong> Autocompletado y documentación inline</li>
            <li><strong>Mantenibilidad:</strong> Código más fácil de entender y refactorizar</li>
            <li><strong>Compartición de tipos:</strong> Mismos interfaces en frontend y backend</li>
        </ul>
    </div>

    <h3>3.4.2. ¿Por qué Drizzle en lugar de Prisma?</h3>
    
    <table>
        <tr>
            <th>Aspecto</th>
            <th>Drizzle</th>
            <th>Prisma</th>
        </tr>
        <tr><td>Rendimiento</td><td>Queries SQL directas</td><td>Capa de abstracción adicional</td></tr>
        <tr><td>Bundle size</td><td>~50KB</td><td>~2MB</td></tr>
        <tr><td>Integración Zod</td><td>Nativa</td><td>Requiere biblioteca externa</td></tr>
    </table>
</div>

<!-- ==================== CAPÍTULO 4 ==================== -->
<div class="chapter">
    <h1>4. PLANIFICACIÓN DEL PROYECTO</h1>
    
    <h2>4.1. Temporalización</h2>
    
    <p>El proyecto se desarrolló siguiendo un enfoque iterativo, dividido en fases bien definidas.</p>

    <h3>4.1.1. Cronograma Detallado</h3>
    
    <table>
        <tr>
            <th>Fase</th>
            <th>Duración</th>
            <th>Actividades</th>
            <th>Entregables</th>
        </tr>
        <tr><td>Fase 0: Preparación</td><td>1 semana</td><td>Configuración entorno, estructura, BD</td><td>Proyecto base funcional</td></tr>
        <tr><td>Fase 1: Concepción</td><td>1 semana</td><td>Análisis requisitos, casos de uso</td><td>Documentación de requisitos</td></tr>
        <tr><td>Fase 2: Diseño</td><td>2 semanas</td><td>Diseño BD, API, mockups UI</td><td>Esquemas y diseños aprobados</td></tr>
        <tr><td>Fase 3: Planificación</td><td>1 semana</td><td>División módulos, priorización</td><td>Backlog priorizado</td></tr>
        <tr><td>Fase 4: Producción</td><td>8 semanas</td><td>Desarrollo backend, frontend, móvil</td><td>Aplicación funcional</td></tr>
        <tr><td>Fase 5: Pruebas</td><td>2 semanas</td><td>Testing, corrección bugs</td><td>Aplicación estable</td></tr>
        <tr><td>Fase 6: Despliegue</td><td>1 semana</td><td>Publicación web, compilación APK</td><td>Aplicación desplegada</td></tr>
    </table>

    <h3>4.1.2. Diagrama de Gantt</h3>
    
    <div class="diagram">
        <pre>
Semana:     1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16
            |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |
Fase 0:     ████
Fase 1:          ████
Fase 2:               ████████
Fase 3:                         ████
Fase 4:                              ████████████████████████████████████████
  Backend:                           ████████████
  Frontend Web:                                ████████████████
  App Móvil:                                                 ████████████
Fase 5:                                                                       ████████
Fase 6:                                                                                ████
        </pre>
    </div>

    <h2>4.2. Metodología de Desarrollo</h2>
    
    <p>Se aplicó una metodología ágil adaptada, combinando principios de Scrum con prácticas de desarrollo iterativo.</p>

    <h3>4.2.1. Principios Aplicados</h3>
    
    <div class="section-small">
        <ul>
            <li><strong>Iteraciones cortas:</strong> Sprints de 1-2 semanas con objetivos definidos</li>
            <li><strong>Entrega continua:</strong> Cada iteración produce una versión funcional</li>
            <li><strong>Priorización MoSCoW:</strong> Must have, Should have, Could have, Won't have</li>
            <li><strong>Feedback continuo:</strong> Revisiones frecuentes y ajustes del plan</li>
        </ul>
    </div>

    <h3>4.2.2. Herramientas de Desarrollo</h3>
    
    <div class="section-small">
        <ul>
            <li><strong>Editor de código:</strong> Visual Studio Code con extensiones para TypeScript, ESLint, Prettier</li>
            <li><strong>Control de versiones:</strong> Git con flujo de ramas feature/develop/main</li>
            <li><strong>Gestión de tareas:</strong> Tablero Kanban con columnas To Do, In Progress, Done</li>
            <li><strong>Documentación:</strong> Markdown para documentación técnica</li>
        </ul>
    </div>

    <h2>4.3. Gestión de Riesgos</h2>
    
    <table>
        <tr>
            <th>Riesgo</th>
            <th>Probabilidad</th>
            <th>Impacto</th>
            <th>Mitigación</th>
        </tr>
        <tr><td>Problemas de rendimiento con consultas complejas</td><td>Media</td><td>Alto</td><td>Optimización de queries, índices</td></tr>
        <tr><td>Errores en gestión de zonas horarias</td><td>Alta</td><td>Alto</td><td>Almacenamiento en UTC, conversión consistente</td></tr>
        <tr><td>Incompatibilidades en app móvil</td><td>Media</td><td>Medio</td><td>Uso de Expo para abstracción</td></tr>
        <tr><td>Cambios en la normativa</td><td>Baja</td><td>Medio</td><td>Arquitectura flexible</td></tr>
    </table>
</div>

<!-- ==================== CAPÍTULO 5 ==================== -->
<div class="chapter">
    <h1>5. DESARROLLO DEL PROYECTO</h1>
    
    <h2>5.0. Fase Previa: Configuración del Entorno</h2>
    
    <h3>5.0.1. Configuración del Entorno de Desarrollo</h3>
    
    <div class="section-small">
        <p>El desarrollo se realizó utilizando <strong>Visual Studio Code</strong> como editor principal, configurado con las siguientes extensiones:</p>
        <ul>
            <li><strong>ESLint:</strong> Análisis estático de código</li>
            <li><strong>Prettier:</strong> Formateo automático de código</li>
            <li><strong>TypeScript Vue Plugin:</strong> Soporte mejorado para TypeScript</li>
            <li><strong>Tailwind CSS IntelliSense:</strong> Autocompletado de clases</li>
            <li><strong>PostgreSQL:</strong> Gestión de base de datos</li>
            <li><strong>REST Client:</strong> Pruebas de API</li>
        </ul>
    </div>

    <h3>5.0.2. Estructura del Proyecto</h3>
    
    <pre>
proyecto/
├── client/                 # Frontend Web (React + Vite)
├── server/                 # Backend (Express)
├── shared/                 # Código compartido (esquemas)
├── mobile-app/             # Aplicación Móvil (Expo)
├── docs/                   # Documentación
├── package.json            # Dependencias raíz
├── tsconfig.json           # Configuración TypeScript
├── vite.config.ts          # Configuración Vite
└── drizzle.config.ts       # Configuración Drizzle
    </pre>

    <h3>5.0.3. Configuración de Base de Datos</h3>
    
    <pre>
// server/db.ts
import { drizzle } from "drizzle-orm/neon-serverless";
import { Pool } from "@neondatabase/serverless";
import * as schema from "@shared/schema";

const pool = new Pool({ connectionString: process.env.DATABASE_URL });
export const db = drizzle(pool, { schema });
    </pre>

    <h2>5.1. Fase de Concepción y Análisis</h2>
    
    <h3>5.1.1. Requisitos Funcionales Detallados</h3>
    
    <div class="section-small">
        <p><strong>RF-01: Autenticación de Usuarios</strong></p>
        <ul>
            <li>El sistema debe permitir el inicio de sesión con email y contraseña</li>
            <li>Las contraseñas deben almacenarse con hash bcrypt (factor 10)</li>
            <li>El sistema debe soportar sesiones para web y JWT para móvil</li>
        </ul>
    </div>

    <div class="section-small">
        <p><strong>RF-02: Gestión de Empleados</strong></p>
        <ul>
            <li>Crear empleados con: número de empleado, nombre, apellidos, email, departamento, rol</li>
            <li>El número de empleado debe ser único</li>
            <li>Eliminar empleados con eliminación en cascada de datos relacionados</li>
        </ul>
    </div>

    <div class="section-small">
        <p><strong>RF-03: Registro de Fichajes</strong></p>
        <ul>
            <li>Registrar entrada (clock_in) y salida (clock_out) con timestamp</li>
            <li>Registrar inicio de pausa (break_start) y fin de pausa (break_end)</li>
            <li>Opcionalmente capturar coordenadas GPS</li>
        </ul>
    </div>

    <h3>5.1.2. Casos de Uso Principales</h3>
    
    <div class="diagram">
        <pre>
┌───────────────────────────────────────────────────────────────────────────┐
│                       CASOS DE USO PRINCIPALES                            │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  EMPLEADO                          ADMINISTRADOR                          │
│  ────────                          ──────────────                         │
│  • Iniciar sesión                  • Todos los del empleado, más:         │
│  • Registrar entrada               • Gestionar empleados (CRUD)           │
│  • Registrar salida                • Gestionar departamentos              │
│  • Iniciar pausa                   • Gestionar roles                      │
│  • Finalizar pausa                 • Asignar horarios                     │
│  • Ver mis horarios                • Registrar incidencias                │
│  • Ver mi historial                • Generar informes                     │
│  • Cerrar sesión                   • Ver dashboard                        │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
        </pre>
    </div>

    <h2>5.2. Fase de Diseño</h2>
    
    <h3>5.2.1. Diseño del Modelo de Datos</h3>
    
    <div class="diagram">
        <pre>
                  ┌─────────────────┐
                  │   DEPARTMENTS   │
                  ├─────────────────┤
                  │ id (PK)         │
                  │ name            │
                  │ description     │
                  └────────┬────────┘
                           │ 1:N
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ ROLES_ENTERPRISE│  │      USERS      │  │  INCIDENTS_TYPE │
├─────────────────┤  ├─────────────────┤  ├─────────────────┤
│ id (PK)         │  │ id (PK)         │  │ id (PK)         │
│ name (UNIQUE)   │◄─│ departmentId(FK)│  │ name            │
│ description     │  │ roleId (FK)     │  │ description     │
└─────────────────┘  │ numEmployee(UQ) │  │ color           │
                     │ firstName       │  └────────┬────────┘
                     │ lastName        │           │
                     │ email (UNIQUE)  │  ┌─────────────────┐
                     │ password        │  │    INCIDENTS    │
                     │ isAdmin         │  ├─────────────────┤
                     └────────┬────────┘  │ id (PK)         │
                              │           │ idUser (FK)     │
         ┌────────────────────┼──────────►│ incidentTypeId  │
         │                    │           │ description     │
         ▼                    ▼           │ date            │
┌─────────────────┐  ┌─────────────────┐  └─────────────────┘
│   SCHEDULES     │  │  CLOCK_ENTRIES  │  ┌─────────────────┐
├─────────────────┤  ├─────────────────┤  │  DAILY_WORKDAY  │
│ id (PK)         │  │ id (PK)         │  ├─────────────────┤
│ idUser (FK)     │  │ userId (FK)     │  │ id (PK)         │
│ date            │  │ entryType       │  │ idUser (FK)     │
│ startTime       │  │ timestamp       │  │ date            │
│ endTime         │  │ latitude        │  │ clockIn         │
│ startBreak      │  │ longitude       │  │ clockOut        │
│ endBreak        │  │ source          │  │ totalHours      │
└─────────────────┘  └─────────────────┘  └─────────────────┘
        </pre>
    </div>

    <h3>5.2.2. Diseño de la API REST</h3>
    
    <table>
        <tr><th>Recurso</th><th>Método</th><th>Endpoint</th><th>Descripción</th></tr>
        <tr><td>Auth</td><td>POST</td><td>/api/auth/login</td><td>Iniciar sesión</td></tr>
        <tr><td>Auth</td><td>POST</td><td>/api/auth/logout</td><td>Cerrar sesión</td></tr>
        <tr><td>Auth</td><td>GET</td><td>/api/auth/me</td><td>Usuario actual</td></tr>
        <tr><td>Users</td><td>GET</td><td>/api/users</td><td>Listar empleados</td></tr>
        <tr><td>Users</td><td>POST</td><td>/api/users</td><td>Crear empleado</td></tr>
        <tr><td>Users</td><td>PATCH</td><td>/api/users/:id</td><td>Actualizar empleado</td></tr>
        <tr><td>Users</td><td>DELETE</td><td>/api/users/:id</td><td>Eliminar empleado</td></tr>
        <tr><td>Clock</td><td>POST</td><td>/api/clock-entries</td><td>Registrar fichaje</td></tr>
        <tr><td>Schedules</td><td>POST</td><td>/api/schedules/batch</td><td>Crear horarios en bloque</td></tr>
        <tr><td>Reports</td><td>GET</td><td>/api/reports/excel</td><td>Generar informe Excel</td></tr>
    </table>
</div>

<!-- ==================== CAPÍTULO 5 - CONTINUACIÓN ==================== -->
<div class="chapter">
    <h2>5.3. Fase de Planificación Técnica</h2>
    
    <p>Se definió la arquitectura técnica del sistema, incluyendo la estructura de directorios, patrones de diseño y convenciones de código.</p>

    <h3>5.3.1. Arquitectura por Capas</h3>
    
    <div class="section-small">
        <ul>
            <li><strong>Routes (Controladores):</strong> Reciben las peticiones HTTP y validan datos de entrada</li>
            <li><strong>Services:</strong> Contienen la lógica de negocio compleja</li>
            <li><strong>Storages:</strong> Encapsulan el acceso a la base de datos</li>
        </ul>
    </div>

    <h2>5.4. Fase de Producción</h2>
    
    <h3>5.4.1. Desarrollo del Backend</h3>
    
    <p>El backend se implementó siguiendo la arquitectura de tres capas definida en la fase de diseño.</p>

    <p><strong>Implementación de Storages:</strong></p>
    
    <pre>
// server/storages/userStorage.ts
import { db } from "../db";
import { users, InsertUser, User } from "@shared/schema";
import { eq, and } from "drizzle-orm";
import bcrypt from "bcryptjs";

export const userStorage = {
  async getAll(): Promise&lt;User[]&gt; {
    return db.select().from(users).where(eq(users.isActive, true));
  },

  async getById(id: string): Promise&lt;User | undefined&gt; {
    const [user] = await db
      .select()
      .from(users)
      .where(and(eq(users.id, id), eq(users.isActive, true)));
    return user;
  },

  async create(data: InsertUser): Promise&lt;User&gt; {
    const hashedPassword = await bcrypt.hash(data.password, 10);
    const [user] = await db
      .insert(users)
      .values({ ...data, password: hashedPassword })
      .returning();
    return user;
  }
};
    </pre>

    <p><strong>Implementación de Rutas:</strong></p>
    
    <pre>
// server/routes/userRoutes.ts
import { Router } from "express";
import { requireAdmin } from "../middleware/auth";
import { userStorage } from "../storages/userStorage";
import { insertUserSchema } from "@shared/schema";

const router = Router();

router.get("/", requireAdmin, async (req, res) =&gt; {
  const users = await userStorage.getAll();
  const sanitizedUsers = users.map(({ password, ...user }) =&gt; user);
  res.json(sanitizedUsers);
});

router.post("/", requireAdmin, async (req, res) =&gt; {
  const validatedData = insertUserSchema.parse(req.body);
  const newUser = await userStorage.create(validatedData);
  res.status(201).json(newUser);
});

export default router;
    </pre>

    <h3>5.4.2. Desarrollo del Frontend Web</h3>
    
    <p>El frontend web se desarrolló con React y TanStack Query para la gestión del estado del servidor.</p>

    <pre>
// Ejemplo de uso de TanStack Query
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";

function EmployeeList() {
  const queryClient = useQueryClient();
  
  const { data: employees, isLoading } = useQuery&lt;User[]&gt;({
    queryKey: ["/api/users"],
  });
  
  const deleteMutation = useMutation({
    mutationFn: (id: string) =&gt; 
      apiRequest(`/api/users/${id}`, "DELETE"),
    onSuccess: () =&gt; {
      queryClient.invalidateQueries({ queryKey: ["/api/users"] });
    }
  });
  
  if (isLoading) return &lt;Skeleton /&gt;;
  
  return (
    &lt;Table&gt;
      {employees?.map(employee =&gt; (
        &lt;TableRow key={employee.id}&gt;
          &lt;TableCell&gt;{employee.firstName}&lt;/TableCell&gt;
          &lt;TableCell&gt;
            &lt;Button onClick={() =&gt; deleteMutation.mutate(employee.id)}&gt;
              Eliminar
            &lt;/Button&gt;
          &lt;/TableCell&gt;
        &lt;/TableRow&gt;
      ))}
    &lt;/Table&gt;
  );
}
    </pre>

    <h3>5.4.3. Desarrollo de la Aplicación Móvil</h3>
    
    <p>La aplicación móvil se desarrolló con React Native y Expo, implementando las funcionalidades de fichaje y geolocalización.</p>

    <pre>
// mobile-app/src/services/location.ts
import * as Location from 'expo-location';

export async function getCurrentLocation() {
  const { status } = await Location.requestForegroundPermissionsAsync();
  if (status !== 'granted') return null;
  
  const location = await Location.getCurrentPositionAsync({
    accuracy: Location.Accuracy.High,
  });
  
  return {
    latitude: location.coords.latitude,
    longitude: location.coords.longitude,
  };
}
    </pre>

    <h2>5.5. Fase de Pruebas</h2>
    
    <div class="section-small">
        <p>Se realizaron pruebas manuales exhaustivas de todas las funcionalidades, incluyendo:</p>
        <ul>
            <li>Pruebas de autenticación (login/logout)</li>
            <li>Pruebas de CRUD de empleados, departamentos, roles</li>
            <li>Pruebas de fichaje desde web y móvil</li>
            <li>Pruebas de geolocalización</li>
            <li>Pruebas de generación de informes Excel</li>
            <li>Pruebas de gestión de zonas horarias</li>
        </ul>
    </div>

    <h2>5.6. Fase de Despliegue</h2>
    
    <div class="section-small">
        <p>El despliegue se realizó utilizando servicios cloud profesionales:</p>
        <ul>
            <li><strong>Backend:</strong> Railway (Node.js + PostgreSQL)</li>
            <li><strong>Frontend:</strong> Vercel (optimizado para React/Vite)</li>
            <li><strong>Base de datos:</strong> Neon PostgreSQL (serverless)</li>
            <li><strong>Aplicación móvil:</strong> Expo EAS Build para compilación de APK/IPA</li>
        </ul>
    </div>

    <h3>5.6.1. Variables de Entorno</h3>
    
    <div class="section-small">
        <ul>
            <li><code>DATABASE_URL</code>: Conexión a PostgreSQL</li>
            <li><code>SESSION_SECRET</code>: Secreto para sesiones web</li>
            <li><code>JWT_SECRET</code>: Secreto para tokens móviles</li>
            <li><code>NODE_ENV</code>: production</li>
        </ul>
    </div>
</div>

<!-- ==================== CAPÍTULO 6 ==================== -->
<div class="chapter">
    <h1>6. ARQUITECTURA DE LA APLICACIÓN</h1>
    
    <h2>6.1. Arquitectura General del Sistema</h2>
    
    <div class="diagram">
        <pre>
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ARQUITECTURA DEL SISTEMA                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────┐        ┌─────────────┐        ┌─────────────┐            │
│   │   Cliente   │        │   Cliente   │        │   Cliente   │            │
│   │     Web     │        │    Móvil    │        │    Admin    │            │
│   │  (React)    │        │(React Native│        │   (Web)     │            │
│   └──────┬──────┘        └──────┬──────┘        └──────┬──────┘            │
│          │                      │                      │                    │
│          └──────────────────────┼──────────────────────┘                    │
│                                 │                                           │
│                         ┌───────▼───────┐                                   │
│                         │   API REST    │                                   │
│                         │  (Express)    │                                   │
│                         └───────┬───────┘                                   │
│                                 │                                           │
│              ┌──────────────────┼──────────────────┐                       │
│              │                  │                  │                        │
│       ┌──────▼──────┐    ┌──────▼──────┐    ┌──────▼──────┐               │
│       │   Routes    │    │  Services   │    │  Storages   │               │
│       │ (Endpoints) │    │  (Lógica)   │    │    (BD)     │               │
│       └─────────────┘    └─────────────┘    └──────┬──────┘               │
│                                                     │                       │
│                                              ┌──────▼──────┐               │
│                                              │ PostgreSQL  │               │
│                                              │  (Neon)     │               │
│                                              └─────────────┘               │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
        </pre>
    </div>

    <h2>6.2. Arquitectura del Backend</h2>
    
    <p>El backend sigue una arquitectura de tres capas que separa responsabilidades:</p>

    <div class="section-small">
        <h3>6.2.1. Capa de Rutas (Routes)</h3>
        <ul>
            <li>Recibe peticiones HTTP</li>
            <li>Valida datos de entrada con Zod</li>
            <li>Devuelve respuestas JSON</li>
            <li>Maneja errores de forma consistente</li>
        </ul>
    </div>

    <div class="section-small">
        <h3>6.2.2. Capa de Servicios (Services)</h3>
        <ul>
            <li>Contiene lógica de negocio compleja</li>
            <li>Coordina operaciones entre múltiples storages</li>
            <li>Calcula horas trabajadas, pausas, etc.</li>
            <li>Genera informes Excel</li>
        </ul>
    </div>

    <div class="section-small">
        <h3>6.2.3. Capa de Almacenamiento (Storages)</h3>
        <ul>
            <li>Encapsula operaciones CRUD</li>
            <li>Utiliza Drizzle ORM</li>
            <li>Maneja transacciones de base de datos</li>
        </ul>
    </div>

    <h2>6.3. Arquitectura del Frontend</h2>
    
    <p>El frontend web sigue una arquitectura basada en componentes con gestión de estado mediante TanStack Query.</p>

    <pre>
client/src/
├── components/
│   ├── ui/                 # Componentes Shadcn/UI
│   ├── app-sidebar.tsx     # Sidebar principal
│   └── theme-toggle.tsx    # Toggle tema oscuro
├── pages/
│   ├── dashboard.tsx       # Panel de control
│   ├── employees.tsx       # Gestión empleados
│   ├── time-tracking.tsx   # Control fichajes
│   ├── schedules.tsx       # Horarios
│   ├── incidents.tsx       # Incidencias
│   └── reports.tsx         # Informes
├── hooks/
│   └── use-toast.ts
├── lib/
│   ├── queryClient.ts
│   └── utils.ts
└── App.tsx
    </pre>

    <h2>6.4. Arquitectura de la Aplicación Móvil</h2>
    
    <p>La aplicación móvil utiliza Expo Router para navegación basada en archivos:</p>

    <pre>
mobile-app/app/
├── _layout.tsx          # Layout raíz (providers)
├── index.tsx            # Redirección inicial
├── login.tsx            # Pantalla de login
└── (tabs)/              # Grupo de tabs (autenticado)
    ├── _layout.tsx      # Layout de tabs
    ├── index.tsx        # Dashboard / Fichar
    ├── schedules.tsx    # Mis horarios
    ├── history.tsx      # Historial
    └── profile.tsx      # Mi perfil
    </pre>
</div>

<!-- ==================== CAPÍTULO 7 ==================== -->
<div class="chapter">
    <h1>7. IMPLEMENTACIÓN DETALLADA</h1>
    
    <h2>7.1. Sistema de Autenticación</h2>
    
    <p>Se implementaron dos sistemas de autenticación para cubrir las necesidades de web y móvil:</p>

    <h3>7.1.1. Autenticación Web (Sesiones)</h3>
    
    <pre>
// server/middleware/auth.ts
export const requireAuth = async (req, res, next) =&gt; {
  if (req.session?.userId) {
    const user = await userStorage.getById(req.session.userId);
    if (user && user.isActive) {
      req.user = { id: user.id, email: user.email, isAdmin: user.isAdmin };
      return next();
    }
  }
  res.status(401).json({ message: "No autorizado" });
};
    </pre>

    <h3>7.1.2. Autenticación Móvil (JWT)</h3>
    
    <pre>
// Verificación de JWT
const authHeader = req.headers.authorization;
if (authHeader?.startsWith("Bearer ")) {
  const token = authHeader.substring(7);
  const decoded = jwt.verify(token, process.env.JWT_SECRET);
  req.user = decoded;
  return next();
}
    </pre>

    <h2>7.2. Sistema de Fichaje</h2>
    
    <p>El sistema de fichaje registra eventos individuales que luego se consolidan en jornadas diarias.</p>

    <h3>7.2.1. Tipos de Fichaje</h3>
    
    <div class="section-small">
        <ul>
            <li><code>clock_in</code>: Entrada al trabajo</li>
            <li><code>clock_out</code>: Salida del trabajo</li>
            <li><code>break_start</code>: Inicio de pausa</li>
            <li><code>break_end</code>: Fin de pausa</li>
        </ul>
    </div>

    <h3>7.2.2. Almacenamiento de Timestamps</h3>
    
    <p>Todos los timestamps se almacenan en UTC para evitar problemas de zonas horarias:</p>

    <pre>
// Al registrar un fichaje
const timestamp = new Date(); // UTC automáticamente
await clockEntryStorage.create({
  userId: req.user.id,
  entryType: 'clock_in',
  timestamp: timestamp,
  source: 'mobile',
  latitude: location?.latitude,
  longitude: location?.longitude
});
    </pre>

    <h2>7.3. Gestión de Horarios</h2>
    
    <p>El sistema permite planificar horarios de trabajo con soporte para turnos continuos y partidos.</p>

    <h3>7.3.1. Estructura del Horario</h3>
    
    <pre>
interface Schedule {
  id: string;
  idUser: string;
  date: string;          // YYYY-MM-DD
  startTime: string;     // HH:MM
  endTime: string;       // HH:MM
  startBreak?: string;   // HH:MM (opcional)
  endBreak?: string;     // HH:MM (opcional)
}
    </pre>

    <h3>7.3.2. Creación en Bloque</h3>
    
    <pre>
router.post("/batch", requireAdmin, async (req, res) =&gt; {
  const { userId, startDate, endDate, schedule } = req.body;
  
  const dates = eachDayOfInterval({
    start: parseISO(startDate),
    end: parseISO(endDate)
  });
  
  const schedules = dates.map(date =&gt; ({
    idUser: userId,
    date: format(date, 'yyyy-MM-dd'),
    ...schedule
  }));
  
  await scheduleStorage.createMany(schedules);
  res.status(201).json({ created: schedules.length });
});
    </pre>

    <h2>7.4. Generación de Informes</h2>
    
    <p>Los informes se generan en formato Excel utilizando la biblioteca ExcelJS:</p>

    <div class="section-small">
        <h3>7.4.1. Estructura del Informe</h3>
        <ul>
            <li>Una hoja por empleado</li>
            <li>Columnas: Día, Horario asignado, Fichaje real, Pausas, Horas trabajadas, Diferencia, Incidencias</li>
            <li>Conversión de timestamps a hora española</li>
        </ul>
    </div>

    <h3>7.4.2. Optimización de Consultas</h3>
    
    <pre>
// Consulta batch en lugar de consulta por día
const clockEntries = await db.select()
  .from(clock_entries)
  .where(and(
    eq(clock_entries.userId, userId),
    between(clock_entries.timestamp, startDate, endDate)
  ));
    </pre>

    <h2>7.5. Geolocalización</h2>
    
    <p>La geolocalización se captura opcionalmente al fichar desde la aplicación móvil:</p>

    <pre>
// Solicitar permisos y obtener ubicación
const { status } = await Location.requestForegroundPermissionsAsync();
if (status === 'granted') {
  const location = await Location.getCurrentPositionAsync();
  // Incluir en el fichaje
  await clockIn({
    latitude: location.coords.latitude,
    longitude: location.coords.longitude
  });
}
    </pre>
</div>

<!-- ==================== CAPÍTULO 8 ==================== -->
<div class="chapter">
    <h1>8. ESTRUCTURA VISUAL</h1>
    
    <h2>8.1. Interfaz Web</h2>
    
    <h3>8.1.1. Diseño General</h3>
    
    <div class="section-small">
        <p>La interfaz web sigue un diseño moderno con sidebar de navegación y área principal de contenido:</p>
        <ul>
            <li><strong>Sidebar izquierdo:</strong> Navegación principal con iconos</li>
            <li><strong>Header:</strong> Título de página y acciones globales</li>
            <li><strong>Área principal:</strong> Contenido de la página actual</li>
            <li><strong>Tema:</strong> Soporte para modo claro y oscuro</li>
        </ul>
    </div>

    <h3>8.1.2. Páginas Principales</h3>
    
    <table>
        <tr><th>Página</th><th>Descripción</th><th>Componentes Principales</th></tr>
        <tr><td>Dashboard</td><td>Panel de control con estadísticas</td><td>Cards con métricas, gráficos</td></tr>
        <tr><td>Empleados</td><td>Gestión de empleados</td><td>Tabla, formularios, diálogos</td></tr>
        <tr><td>Fichajes</td><td>Control de fichajes del día</td><td>Lista, mapa, formulario manual</td></tr>
        <tr><td>Horarios</td><td>Planificación de turnos</td><td>Calendario anual, formularios</td></tr>
        <tr><td>Incidencias</td><td>Gestión de incidencias</td><td>Tabla, filtros, formularios</td></tr>
        <tr><td>Informes</td><td>Generación de informes</td><td>Selectores, botón descarga</td></tr>
    </table>

    <h2>8.2. Interfaz Móvil</h2>
    
    <h3>8.2.1. Diseño General</h3>
    
    <div class="section-small">
        <p>La aplicación móvil utiliza navegación por pestañas en la parte inferior:</p>
        <ul>
            <li><strong>Tab 1 - Fichar:</strong> Botones de fichaje y estado actual</li>
            <li><strong>Tab 2 - Horarios:</strong> Calendario con turnos asignados</li>
            <li><strong>Tab 3 - Historial:</strong> Lista de fichajes anteriores</li>
            <li><strong>Tab 4 - Perfil:</strong> Datos del usuario y logout</li>
        </ul>
    </div>

    <h3>8.2.2. Pantalla de Fichaje</h3>
    
    <div class="section-small">
        <p>La pantalla principal muestra:</p>
        <ul>
            <li>Estado actual (trabajando, en pausa, fuera de jornada)</li>
            <li>Hora de última acción</li>
            <li>Botones de acción según estado</li>
            <li>Indicador de geolocalización</li>
        </ul>
    </div>
</div>

<!-- ==================== CAPÍTULO 9 ==================== -->
<div class="chapter">
    <h1>9. GESTIÓN DE DATOS</h1>
    
    <h2>9.1. Modelo de Datos Completo</h2>
    
    <h3>9.1.1. Tablas Principales</h3>
    
    <table>
        <tr><th>Tabla</th><th>Descripción</th><th>Campos Clave</th></tr>
        <tr><td>users</td><td>Empleados del sistema</td><td>id, numEmployee, firstName, lastName, email, password, isAdmin</td></tr>
        <tr><td>departments</td><td>Departamentos de la empresa</td><td>id, name, description</td></tr>
        <tr><td>roles_enterprise</td><td>Roles empresariales</td><td>id, name, description</td></tr>
        <tr><td>clock_entries</td><td>Eventos de fichaje</td><td>id, userId, entryType, timestamp, latitude, longitude, source</td></tr>
        <tr><td>daily_workday</td><td>Resumen diario de jornada</td><td>id, idUser, date, clockIn, clockOut, totalHours</td></tr>
        <tr><td>schedules</td><td>Horarios planificados</td><td>id, idUser, date, startTime, endTime, startBreak, endBreak</td></tr>
        <tr><td>incidents</td><td>Incidencias laborales</td><td>id, idUser, incidentTypeId, date, description</td></tr>
        <tr><td>incidents_type</td><td>Tipos de incidencia</td><td>id, name, description, color</td></tr>
    </table>

    <h2>9.2. Gestión de Zonas Horarias</h2>
    
    <p>La gestión de zonas horarias es crítica para un sistema de fichaje. Se implementó la siguiente estrategia:</p>

    <div class="info-box">
        <strong>Principio Fundamental: Almacenar en UTC, mostrar en hora local.</strong>
        <p>Todos los timestamps se almacenan en UTC en la base de datos. La conversión a hora española (Europe/Madrid) se realiza únicamente en el momento de mostrar los datos al usuario o generar informes.</p>
    </div>

    <h3>9.2.1. Implementación</h3>
    
    <pre>
// server/utils/timezone.ts
import { format, toZonedTime } from 'date-fns-tz';

const TIMEZONE = 'Europe/Madrid';

export function formatSpanishTime(date: Date): string {
  const zonedDate = toZonedTime(date, TIMEZONE);
  return format(zonedDate, 'HH:mm', { timeZone: TIMEZONE });
}

export function getSpanishDate(date: Date): string {
  const zonedDate = toZonedTime(date, TIMEZONE);
  return format(zonedDate, 'yyyy-MM-dd', { timeZone: TIMEZONE });
}
    </pre>

    <h3>9.2.2. Consideraciones</h3>
    
    <div class="section-small">
        <ul>
            <li>El cambio horario (verano/invierno) se maneja automáticamente</li>
            <li>Las consultas SQL utilizan <code>AT TIME ZONE 'Europe/Madrid'</code></li>
            <li>Los informes Excel muestran siempre hora española</li>
        </ul>
    </div>

    <h2>9.3. Integridad y Consistencia</h2>
    
    <h3>9.3.1. Restricciones de Integridad</h3>
    
    <div class="section-small">
        <ul>
            <li><strong>Unicidad:</strong> numEmployee, email (users), name (roles_enterprise)</li>
            <li><strong>Foreign Keys:</strong> Todas las relaciones con ON DELETE CASCADE</li>
            <li><strong>NOT NULL:</strong> Campos obligatorios definidos en el esquema</li>
        </ul>
    </div>

    <h3>9.3.2. Eliminación en Cascada</h3>
    
    <div class="section-small">
        <p>Al eliminar un empleado, se eliminan en cascada:</p>
        <ol>
            <li>Entradas de fichaje (clock_entries)</li>
            <li>Incidencias (incidents)</li>
            <li>Horarios (schedules)</li>
            <li>Jornadas diarias (daily_workday)</li>
        </ol>
    </div>
</div>

<!-- ==================== CAPÍTULO 10 ==================== -->
<div class="chapter">
    <h1>10. SEGURIDAD</h1>
    
    <h2>10.1. Autenticación</h2>
    
    <h3>10.1.1. Almacenamiento de Contraseñas</h3>
    
    <p>Las contraseñas se almacenan utilizando bcrypt con un factor de coste de 10:</p>

    <pre>
import bcrypt from 'bcryptjs';

// Al crear usuario
const hashedPassword = await bcrypt.hash(plainPassword, 10);

// Al verificar login
const isValid = await bcrypt.compare(inputPassword, storedHash);
    </pre>

    <h3>10.1.2. Tokens JWT</h3>
    
    <div class="section-small">
        <p>Los tokens JWT para la aplicación móvil incluyen:</p>
        <ul>
            <li>ID del usuario</li>
            <li>Email</li>
            <li>Rol (isAdmin)</li>
            <li>Expiración: 7 días</li>
        </ul>
    </div>

    <h2>10.2. Autorización</h2>
    
    <h3>10.2.1. Roles del Sistema</h3>
    
    <table>
        <tr><th>Rol</th><th>Descripción</th><th>Permisos</th></tr>
        <tr><td>Empleado</td><td>Usuario estándar</td><td>Fichar, ver sus horarios, ver su historial</td></tr>
        <tr><td>Administrador</td><td>Acceso completo</td><td>Todos los permisos, gestión de empleados, informes</td></tr>
    </table>

    <h3>10.2.2. Middleware de Autorización</h3>
    
    <pre>
export const requireAdmin = async (req, res, next) =&gt; {
  await requireAuth(req, res, () =&gt; {
    if (!req.user?.isAdmin) {
      return res.status(403).json({ 
        message: "Acceso denegado. Se requiere rol de administrador." 
      });
    }
    next();
  });
};
    </pre>

    <h2>10.3. Protección de Datos (RGPD)</h2>
    
    <h3>10.3.1. Principios Aplicados</h3>
    
    <div class="section-small">
        <ul>
            <li><strong>Minimización:</strong> Solo se recogen datos estrictamente necesarios</li>
            <li><strong>Finalidad:</strong> Datos usados exclusivamente para control horario</li>
            <li><strong>Consentimiento:</strong> Geolocalización opcional con permiso explícito</li>
            <li><strong>Acceso:</strong> Empleados pueden consultar sus propios datos</li>
            <li><strong>Seguridad:</strong> Contraseñas hasheadas, conexiones HTTPS</li>
            <li><strong>Localización:</strong> Datos almacenados en servidores de la UE</li>
        </ul>
    </div>

    <h3>10.3.2. Derechos de los Usuarios</h3>
    
    <div class="section-small">
        <ul>
            <li><strong>Acceso:</strong> Consulta de historial de fichajes</li>
            <li><strong>Rectificación:</strong> Solicitud de corrección de datos erróneos</li>
            <li><strong>Supresión:</strong> Mediante el administrador del sistema</li>
            <li><strong>Portabilidad:</strong> Exportación de datos en formato Excel</li>
        </ul>
    </div>
</div>

<!-- ==================== CAPÍTULO 11 ==================== -->
<div class="chapter">
    <h1>11. TESTS Y VALIDACIÓN</h1>
    
    <h2>11.1. Estrategia de Testing</h2>
    
    <p>Se aplicó una estrategia de testing manual exhaustivo complementada con validación automática:</p>

    <h3>11.1.1. Validación de Datos</h3>
    
    <p>Toda la entrada de datos se valida utilizando esquemas Zod:</p>

    <pre>
// shared/schema.ts
export const insertUserSchema = createInsertSchema(users).omit({
  id: true,
  createdAt: true
}).extend({
  password: z.string().min(8, "La contraseña debe tener al menos 8 caracteres"),
  email: z.string().email("Email inválido"),
  numEmployee: z.string().min(1, "El número de empleado es obligatorio")
});
    </pre>

    <h3>11.1.2. Pruebas Manuales</h3>
    
    <table>
        <tr><th>Área</th><th>Casos de Prueba</th><th>Resultado</th></tr>
        <tr><td>Autenticación</td><td>Login correcto, login incorrecto, logout, sesión expirada</td><td>✓ Pasado</td></tr>
        <tr><td>Empleados</td><td>Crear, editar, eliminar, listar, buscar</td><td>✓ Pasado</td></tr>
        <tr><td>Fichajes</td><td>Entrada, salida, pausas, geolocalización</td><td>✓ Pasado</td></tr>
        <tr><td>Horarios</td><td>Crear individual, crear en bloque, calendario</td><td>✓ Pasado</td></tr>
        <tr><td>Informes</td><td>Generación Excel, conversión horaria</td><td>✓ Pasado</td></tr>
        <tr><td>Móvil</td><td>Todas las funcionalidades de la app</td><td>✓ Pasado</td></tr>
    </table>

    <h2>11.2. Validación de Requisitos</h2>
    
    <p>Se verificó el cumplimiento de todos los requisitos funcionales y técnicos definidos en la fase de análisis.</p>
</div>

<!-- ==================== CAPÍTULO 12 ==================== -->
<div class="chapter">
    <h1>12. CUMPLIMIENTO NORMATIVO</h1>
    
    <h2>12.1. Verificación de Requisitos Legales</h2>
    
    <p>El sistema cumple con todos los requisitos de la nueva normativa española de registro horario digital:</p>

    <table>
        <tr><th>Requisito Legal</th><th>Implementación</th><th>Estado</th></tr>
        <tr><td>Formato digital obligatorio</td><td>Aplicación web y móvil</td><td>✓ Cumple</td></tr>
        <tr><td>Trazabilidad completa</td><td>UUID único, timestamps precisos, source del fichaje</td><td>✓ Cumple</td></tr>
        <tr><td>Inmutabilidad de registros</td><td>Entradas clock_entries no modificables</td><td>✓ Cumple</td></tr>
        <tr><td>Acceso para trabajadores</td><td>App móvil con historial personal</td><td>✓ Cumple</td></tr>
        <tr><td>Acceso para Inspección</td><td>Exportación Excel</td><td>✓ Cumple</td></tr>
        <tr><td>Conservación 4 años</td><td>Base de datos persistente</td><td>✓ Cumple</td></tr>
        <tr><td>Registro de pausas</td><td>break_start y break_end</td><td>✓ Cumple</td></tr>
        <tr><td>Fichaje personal</td><td>Login individual requerido</td><td>✓ Cumple</td></tr>
        <tr><td>Servidores en UE</td><td>PostgreSQL en servidores europeos</td><td>✓ Cumple</td></tr>
        <tr><td>No biometría</td><td>No usa huella ni reconocimiento facial</td><td>✓ Cumple</td></tr>
        <tr><td>Geolocalización no permanente</td><td>Solo captura en momento del fichaje</td><td>✓ Cumple</td></tr>
    </table>
</div>

<!-- ==================== CAPÍTULO 13 ==================== -->
<div class="chapter">
    <h1>13. ANÁLISIS Y VALORACIÓN</h1>
    
    <h2>13.1. Conclusiones</h2>
    
    <p>El desarrollo del Sistema de Control de Fichajes de Empleados ha sido un proyecto completo que ha permitido crear una solución profesional para una necesidad real del mercado español.</p>

    <h3>13.1.1. Objetivos Cumplidos</h3>
    
    <div class="section-small">
        <ul>
            <li>✓ Sistema de autenticación seguro con roles diferenciados</li>
            <li>✓ Gestión completa de empleados, departamentos y roles</li>
            <li>✓ Registro de fichajes con entrada, salida y pausas</li>
            <li>✓ Geolocalización opcional en fichajes móviles</li>
            <li>✓ Planificación de horarios con calendario anual</li>
            <li>✓ Gestión de incidencias laborales</li>
            <li>✓ Dashboard con estadísticas en tiempo real</li>
            <li>✓ Generación de informes en Excel</li>
            <li>✓ Aplicación móvil nativa funcional</li>
            <li>✓ Cumplimiento de la normativa de registro horario digital</li>
        </ul>
    </div>

    <h3>13.1.2. Lecciones Aprendidas</h3>
    
    <div class="section-small">
        <ol>
            <li><strong>Gestión de zonas horarias:</strong> Es fundamental decidir desde el inicio cómo se manejarán las fechas. El almacenamiento en UTC con conversión a zona local es la mejor práctica.</li>
            <li><strong>Tipado estático:</strong> TypeScript ha sido invaluable para detectar errores y facilitar refactorizaciones.</li>
            <li><strong>Arquitectura modular:</strong> La separación en capas facilita enormemente el mantenimiento.</li>
            <li><strong>Validación compartida:</strong> Usar Zod en frontend y backend garantiza consistencia.</li>
            <li><strong>Componentes reutilizables:</strong> Shadcn/UI acelera significativamente el desarrollo.</li>
        </ol>
    </div>

    <h2>13.2. Mejoras Propuestas</h2>
    
    <h3>13.2.1. Mejoras a Corto Plazo</h3>
    
    <div class="section-small">
        <ul>
            <li>Notificaciones push para recordatorios de fichaje</li>
            <li>Fichaje offline con sincronización posterior</li>
            <li>Aprobación de fichajes manuales por supervisor</li>
            <li>Alertas de anomalías (olvidos de fichaje, exceso de horas)</li>
        </ul>
    </div>

    <h3>13.2.2. Mejoras a Medio Plazo</h3>
    
    <div class="section-small">
        <ul>
            <li>Integración con sistemas de nóminas</li>
            <li>Multi-idioma (inglés, catalán, euskera, gallego)</li>
            <li>Roles intermedios (supervisor, responsable de departamento)</li>
            <li>Planificación de vacaciones y ausencias</li>
        </ul>
    </div>

    <h3>13.2.3. Mejoras a Largo Plazo</h3>
    
    <div class="section-small">
        <ul>
            <li>Versión PWA para funcionamiento offline</li>
            <li>API pública para integraciones de terceros</li>
            <li>Aplicación de escritorio para terminales de fichaje</li>
            <li>Análisis predictivo de absentismo</li>
        </ul>
    </div>
</div>

<!-- ==================== CAPÍTULO 14 ==================== -->
<div class="chapter">
    <h1>14. BIBLIOGRAFÍA Y REFERENCIAS</h1>
    
    <h2>14.1. Normativa Legal</h2>
    
    <div class="section-small">
        <ul>
            <li>Real Decreto-ley 8/2019, de 8 de marzo, de medidas urgentes de protección social y de lucha contra la precariedad laboral en la jornada de trabajo</li>
            <li>Estatuto de los Trabajadores, Artículo 34.9 (modificado)</li>
            <li>Anteproyecto de Ley de Registro Horario Digital 2024-2025</li>
            <li>Reglamento General de Protección de Datos (RGPD) - Reglamento (UE) 2016/679</li>
        </ul>
    </div>

    <h2>14.2. Documentación Técnica</h2>
    
    <div class="section-small">
        <ul>
            <li><strong>React:</strong> https://react.dev</li>
            <li><strong>TypeScript:</strong> https://www.typescriptlang.org/docs/</li>
            <li><strong>Expo:</strong> https://docs.expo.dev</li>
            <li><strong>Drizzle ORM:</strong> https://orm.drizzle.team</li>
            <li><strong>TanStack Query:</strong> https://tanstack.com/query/latest</li>
            <li><strong>Shadcn/UI:</strong> https://ui.shadcn.com</li>
            <li><strong>Tailwind CSS:</strong> https://tailwindcss.com/docs</li>
            <li><strong>Express:</strong> https://expressjs.com</li>
            <li><strong>PostgreSQL:</strong> https://www.postgresql.org/docs/</li>
            <li><strong>Zod:</strong> https://zod.dev</li>
            <li><strong>date-fns:</strong> https://date-fns.org</li>
        </ul>
    </div>

    <h2>14.3. Recursos sobre la Normativa</h2>
    
    <div class="section-small">
        <ul>
            <li>Protime - Ley de registro horario digital 2025</li>
            <li>Factorial - Nueva Ley de Control Horario</li>
            <li>Kelio - Nueva ley control horario trabajadores 2025</li>
            <li>Sesame HR - Control horario novedades 2025</li>
        </ul>
    </div>
</div>

<!-- ==================== CAPÍTULO 15 ==================== -->
<div class="chapter">
    <h1>15. ANEXOS</h1>
    
    <h2>15.1. Estructura Completa del Proyecto</h2>
    
    <pre>
proyecto/
├── client/                         # Frontend Web
│   ├── src/
│   │   ├── components/
│   │   │   ├── ui/                 # Componentes Shadcn/UI (40+)
│   │   │   ├── app-sidebar.tsx
│   │   │   └── theme-toggle.tsx
│   │   ├── pages/
│   │   │   ├── dashboard.tsx
│   │   │   ├── employees.tsx
│   │   │   ├── time-tracking.tsx
│   │   │   ├── schedules.tsx
│   │   │   ├── incidents.tsx
│   │   │   ├── reports.tsx
│   │   │   ├── settings.tsx
│   │   │   └── login.tsx
│   │   ├── hooks/
│   │   ├── lib/
│   │   ├── App.tsx
│   │   └── main.tsx
│   └── index.html
│
├── server/
│   ├── routes/                     # 13 archivos de rutas
│   ├── storages/                   # 10 archivos de storage
│   ├── services/                   # 9 archivos de servicios
│   ├── middleware/
│   ├── utils/
│   ├── db.ts
│   └── index.ts
│
├── shared/
│   └── schema.ts                   # Esquemas compartidos
│
├── mobile-app/
│   ├── app/
│   │   ├── (tabs)/
│   │   └── login.tsx
│   ├── components/
│   ├── services/
│   └── types/
│
└── docs/
    └── memoria-proyecto.html
    </pre>

    <h2>15.2. Variables de Entorno</h2>
    
    <table>
        <tr><th>Variable</th><th>Descripción</th><th>Ejemplo</th></tr>
        <tr><td>DATABASE_URL</td><td>Conexión a PostgreSQL</td><td>postgresql://user:pass@host:5432/db</td></tr>
        <tr><td>SESSION_SECRET</td><td>Secreto para sesiones web</td><td>random-string-32-characters</td></tr>
        <tr><td>JWT_SECRET</td><td>Secreto para tokens JWT</td><td>another-random-string-32-chars</td></tr>
        <tr><td>NODE_ENV</td><td>Entorno de ejecución</td><td>development | production</td></tr>
    </table>

    <h2>15.3. Comandos de Desarrollo</h2>
    
    <pre>
# Desarrollo
npm run dev              # Iniciar servidor de desarrollo

# Base de datos
npm run db:push          # Aplicar cambios de esquema
npm run db:studio        # Abrir Drizzle Studio

# Móvil
cd mobile-app
npx expo start           # Iniciar Expo
eas build --platform android --profile production  # Compilar APK
    </pre>
</div>

<!-- ==================== FIN DEL DOCUMENTO ==================== -->
<div class="chapter">
    <div class="footer-final">
        <h2>FIN DEL DOCUMENTO</h2>
        <p style="margin-top: 30px; color: #4a5568;">
            <strong>Sistema de Control de Fichajes de Empleados</strong><br>
            Trabajo de Fin de Grado<br>
            Curso Académico 2024-2025
        </p>
        <p style="margin-top: 20px; font-size: 10pt; color: #718096;">
            Desarrollado para cumplir con la nueva normativa española<br>
            de registro horario digital obligatorio
        </p>
    </div>
</div>

</body>
</html>
